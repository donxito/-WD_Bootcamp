

# React - Token-Based Authentication I (Backend)


<!-- 

status: draft

-->





## Intro


<!--

@Luis: have prepared (open) project from module 2 (library project)

-->

- Quick refresh "the concern on users' security"
  - We will not store passwords
  - We store a representation: `HASH`




## Notes

UPDATE OCT. 2022:
- ironlauncher --auth --json now does token based auth
- code in the students portal is almost the same as ironlauncher
- differences:
  - students portal uses `bcryptjs`, ironlauncher uses `bcrypt` (should be fine, I think both provide the same methods).
  - implement `protected routes` ("Establish Protected Routes")


Instead of codealong, read & understand the code.


## Read & understand code generated by Ironlauncher --auth --json

<!-- 
@Luis: use code as it is  (do not change anything)
-->



POST /auth/signup
- ask students to read the code [3-4min]
- explain
- test with Postman

POST /auth/login
<!-- @LT: explain JWT once we reach that code in /login (not before)  -->
- ask students to read the code [5min]
- explain route + `explain JWT` (details below)
- test with Postman
  
POST /auth/verify:
- explain
- test with Postman


## JSON Web Tokens (JWT)


- Session-based auth (module2) vs. tokens (module3)
  - Module 2 diagram: 
    - session (server keeps information about the state of the user)
    - sessionId (sent on each request)
  - JWT Diagram: https://education-team-2020.s3.eu-west-1.amazonaws.com/web-dev/m3/token-auth/jwt-authentication-flow-1.png
  - Token-based authentication is stateless which means that no information is stored on the server.

<!-- @todo: create diagrams -->

Token == "a document that is signed" (anyone in possession )


`jwt.sign` (payload + secret + header):
- https://education-team-2020.s3.eu-west-1.amazonaws.com/web-dev/m3/token-auth/jwt-signature.png


- (brief) Session auth vs Token auth
  - Each have advantages and disadvantages
  - Advantages & Disadvantages: https://stackoverflow.com/a/71552858/11298742
  - In depth comparison: https://stackoverflow.com/a/35059874/11298742




## Implement protected routes

- Protect some routes using middleware





## Improve error handling

Protected routes: if we use ironlauncher, in `error-handling\index.js`, we can add the following:

  ```js
      if (err.name === "UnauthorizedError") {
        res.status(401).json({message: "invalid token..."});
      }
  ```

  Example: https://github.com/Ironborn-Ironhack-March-2022/ironborn-project-management-server/commit/d6bea33a492aeffa16408575d136324ed72abc21



## Extra resources

Video - Session vs Token Authentication in 100 Seconds (Fireship, 2min)
https://www.youtube.com/watch?v=UBUNrFtufWo



## (OLD) Steps to change from session to token-based authentication

- In the old versions of ironlauncher, --auth provides session-based authentication.

- Steps to follow to move from session to token-based auth:
  https://github.com/ironhack-rmt-resources/ironlauncher-jwt-auth


